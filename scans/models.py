# -*- coding: utf-8 -*-
from __future__ import unicode_literals
from datetime import datetime
from django.db import models

# Create your models here.

from assets.models import AssetGroup


class ScanProfile(models.Model):
    profile_name = models.CharField(max_length=60,null=False,blank=False)
    profile_type = models.CharField(
        max_length=16,
        choices=(('Auth','Authenticated'),('Unauth', 'Unauthenticated')),
        default='Unauth',
    )
    profile_port_type = models.CharField(
        max_length=3,
        choices=(('C','Most popular 100 ports'),('', 'UDP')),
        default='T'
    )
    profile_ports = models.TextField(max_length=3000,default="22,25,443,53")

    def __str__(self):
        return self.profile_name


class Result(models.Model):
    result_id = models.AutoField(primary_key=True)
    result_title = models.CharField(max_length=60,null=False,blank=False)
    result_data  = models.CharField(max_length=60,null=False,blank=False)

    def __str__(self):
        return self.result_title

class Scan(models.Model):
    scan_id = models.AutoField(primary_key=True)
    scan_title = models.CharField(max_length=60,null=False,blank=False)
    create_date = models.DateTimeField(default=datetime.now, blank=True)
    last_scan = models.DateTimeField(auto_now_add=False, auto_now=True)
    scan_targets = models.ForeignKey(AssetGroup, on_delete=models.CASCADE,parent_link=True)
    profile = models.ForeignKey(ScanProfile,on_delete=models.CASCADE,parent_link=True)
    status = models.CharField(max_length=20,choices=(("d","done"),("s","scanning"),("n","none")))
    scan_result = models.ForeignKey(Result,on_delete=models.SET_NULL,null=True)

    def __str__(self):
        return self.scan_title
