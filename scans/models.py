# -*- coding: utf-8 -*-
from __future__ import unicode_literals
from datetime import datetime
from django.db import models

# Create your models here.

from assets.models import AssetGroup


class ScanProfile(models.Model):
    profile_name = models.CharField(max_length=60,null=False,blank=False)
    scan_type = models.CharField(
        max_length=16,
        choices=(('Auth','Authenticated'),('Unauth', 'Unauthenticated')),
        default='Unauth',
    )
    port_type = models.CharField(
        max_length=10,
        choices=(('Light','Most popular 100 ports'),('Specific', 'Specific ports')),
        default='Light'
    )
    port_list = models.TextField(max_length=3000,default="22,25,443,53",null=True,blank=True)

    def __str__(self):
        return self.profile_name


class Result(models.Model):
    result_id = models.AutoField(primary_key=True)
    title = models.CharField(max_length=60,null=False,blank=False)
    xml_data  = models.TextField(null=False,blank=False)
    html_data = models.TextField(null=True,blank=True)
    create_date = models.DateTimeField(default=datetime.now, blank=True)

    html_data.allow_tags = True

    def __str__(self):
        return self.title

class Scan(models.Model):
    scan_id = models.AutoField(primary_key=True)
    scan_title = models.CharField(max_length=60,null=False,blank=False)
    create_date = models.DateTimeField(default=datetime.now, blank=True)
    last_scan = models.DateTimeField(auto_now_add=False, auto_now=True)
    targets = models.ForeignKey(AssetGroup, on_delete=models.CASCADE, parent_link=True)
    profile = models.ForeignKey(ScanProfile,on_delete=models.CASCADE,parent_link=True)
    status = models.CharField(max_length=20,choices=(("d","done"),("s","scanning"),("n","none")))
    result = models.ForeignKey(Result, on_delete=models.SET_NULL, null=True)

    def __str__(self):
        return self.scan_title
