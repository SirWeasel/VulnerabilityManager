# -*- coding: utf-8 -*-
from __future__ import unicode_literals

from django.contrib import admin
from django.urls import reverse
import json
# Register your models here.
from django.utils.safestring import mark_safe
from json2html import *
from knowledgebase.models import KnowledgeBase


class KnowledgeBaseAdmin(admin.ModelAdmin):
    list_display = [f.name for f in KnowledgeBase._meta.fields if "id" not in f.name]

    readonly_fields = ["vulnerability_list","exploit_list","vulnerability_list_html"]

    def vulnerability_list_html(self, obj):

        #    f.write("\nOUT:  ",str(cpe_vulnerabilities_list))

        display_text = "".join(json2html.convert(json = obj.vulnerability_list))
        with open('/var/www/VulnerabilityManager/scanresults','a+') as f:
            f.write("\nCPE VULNS:  "+display_text)
        if display_text:
            return mark_safe(display_text)
        return obj.vulnerability_list

    class Meta:
        model = KnowledgeBase


admin.site.register(KnowledgeBase, KnowledgeBaseAdmin)
