# -*- coding: utf-8 -*-
from __future__ import unicode_literals

from django.contrib import admin
from django.contrib.contenttypes.models import ContentType
from django.http import HttpResponseRedirect
# Register your models here.
from .models import Asset, Credential, AssetGroup


class AssetAdmin(admin.ModelAdmin):
    class Meta:
        model = Asset

    readonly_fields = ["added_date"]

    def create_asset_group(self,request,queryset):
        asset_group_name = "AG:"
        for asset in queryset:
            asset_group_name += asset.hostname+", "
        asset_group_name = asset_group_name[:-2]
        assetgr = AssetGroup.objects.create(name=asset_group_name)
        assetgr.assets.set(queryset)

        return HttpResponseRedirect("/assets/assetgroup/")

    create_asset_group.short_description = "Create an asset group from Assets"

    list_display = [f.name for f in Asset._meta.fields if "id" not in f.name]
    actions = [create_asset_group]


class AssetGroupAdmin(admin.ModelAdmin):
    class Meta:
        model = AssetGroup

    list_display = [f.name for f in AssetGroup._meta.fields if "id" not in f.name]


class CredentialAdmin(admin.ModelAdmin):
    class Meta:
        model = Credential



admin.site.register(Asset,AssetAdmin)
admin.site.register(Credential,CredentialAdmin)
admin.site.register(AssetGroup,AssetGroupAdmin)
